# API Ref Guidelines <!-- omit in toc -->

## Table of Contents <!-- omit in toc -->

- [Scope](#scope)
- [Who is the customer?](#who-is-the-customer)
- [How much documentation should I add?](#how-much-documentation-should-i-add)
- [Can I exclude code from being included in the documentation?](#can-i-exclude-code-from-being-included-in-the-documentation)
- [How should I format my code comments?](#how-should-i-format-my-code-comments)
  - [General Style](#general-style)
  - [Classes and Structures](#classes-and-structures)
  - [Member Data](#member-data)
  - [Functions and Function Parameters](#functions-and-function-parameters)
  - [Macros](#macros)
  - [Enumerations](#enumerations)
  - [Namespaces](#namespaces)
  - [Header files](#header-files)
  - [Deprecations](#deprecations)
  - [Complete Example](#complete-example)
- [Extras](#extras)
  - [Linking to other APIs](#linking-to-other-apis)
  - [Linking to Other Guides and Sites](#linking-to-other-guides-and-sites)
  - [See Also](#see-also)
  - [Notes](#notes)
  - [Code Snippets](#code-snippets)
  - [Section Comments](#section-comments)
- [Excluding code from the documentation](#excluding-code-from-the-documentation)
- [Exceptions](#exceptions)
- [Can I build the documentation to see the final result?](#can-i-build-the-documentation-to-see-the-final-result)

## Scope

This page describes how to comment O3DE's C++ code to produce consistent, high-quality documentation for O3DE’s public-facing C++ API Reference Guide. The intended audiences of _this page_ are O3DE developers and programming writers.

We list the minimum code elements to document, describe how to add the documentation, and provide examples of documenting different types of elements. Descriptions of how to build and publish the API Reference Guide are out of scope of this document.

## Who is the customer?

An API Reference consists of two major parts

1. The actual header and cpp files that are shipped as part of O3DE, viewed by developers in their IDE as they work on the code.
2. Generated API Reference Guides, generated by [Doxygen](http://www.stack.nl/~dimitri/doxygen/), which is a standard tool for producing documentation from C++ code.

The primary consumer of the API reference are developers using O3DE and reading the comments directly in source code.

Note: We have configured Doxygen to ignore "docs.h" files, which solely contain documentation. Docs for specific APIs will be moved to the corresponding header files, and extensive documentation will be moved to the [O3DE Developer Guide](https://o3de.org/docs/).

## How much documentation should I add?

Doxygen distinguishes between two types of descriptions: brief descriptions and detailed descriptions. With our configuration, a brief description is the first sentence of a Doxygen-formatted code comment (described later). A detailed description is anything that follows the first sentence.

Do not use `@brief` or `/brief`. Our doxygen configuration automatically assumes the first sentence (ending with a period) is the brief description in a comment block or multiline comment.

In general, when deciding what to document and how much, just consider the customer whenever adding documentation.  The customer is primarily a developer reading the public API headers and trying to quickly figure out what APIs are available, what they do, and how to use them. This means that information that is redundant and provides no extra information is of negative value, as it will clutter the header and make it harder to read. But information that is useful to a reader such as input constraints, explanation of a class's purpose, references to other related structures, explanation of parameters that have idiosyncrasies, and other explanations that help a reader of the header understand how to use the API are all recommended.

Avoid adding _too much_ documentation to API headers about the inner workings.  You can reserve deep explorations of the code for the .cpp file itself, if necessary.

## Can I exclude code from being included in the documentation?

Yes. Sometimes there are classes, files, or entire namespaces that we don't want to expose to customers via the public-facing docs for various reasons. Typically, if customers don't need to know about something, we don't want it cluttering up the docs. Even if we don't add Doxygen-style comments to an item, Doxygen still scans the code and lists the item in the docs.

Our Doxygen config **already excludes** the `AZ::Internal` namespace. Code marked as private, files with "test" in the name, files with "ReleaseNotes" in the name, and `docs.h` files. You don't need to do anything to get Doxygen to ignore those items, because they're already taken care of. In all other cases, follow the instructions in [Excluding code from the documentation](#excluding-code-from-the-documentation).

## How should I format my code comments?

Doxygen supports several different comment styles, but in order to maintain a consistent code base while also providing flexibility, we have settled on one style all comments.

### General Style

In general, we will always follow this style for all documented c/c++ code with few exceptions.

**Chameleon Rule**:  Blend in.  If you find yourself making changes to code that uses a different format, please adapt to conform to the existing format rather than produce inconsistency, unless it will actually harm the ability to document the code. It is also not okay to make massive amounts of unrelated changes to a code file to satisfy a commenting style because such changes cause merge conflicts for customers, a downside which outweighs the upside of comments looking nicer.

**In all other cases**: We prefer using `//!` style comments for all kinds of comments (and `//!<` for same-line postfix documentation). Avoid using multiple lines of postfix style (`//!<`) even though Doxygen supports it - if you need many lines, prefer putting the documentation before the member being documented.

Use whitespace in your documentation as you see fit to provide maximum readability as long as it does not violate other elements of our Coding Standards.

**Gotchas**:

- Don't include any periods within the brief description (like "e.g.") because Doxygen terminates the brief description at the **first period**.
- Be sure to place the comment immediately above the thing being documented. Doxygen will attribute documentation to the next element encountered after the documentation comment (including namespaces, class names, macros, etc).

**Example comments**:

```c++
//! This is the summary of 'bar'.
//! This is the full description of 'bar'. Everything up to the first
//! period is the brief summary. Everything after that period is the detailed
//! description of 'bar', no matter how many lines it takes.
int bar;

//! Short summary of what 'foo' is (no long description)
int foo;

int baz; //!< Short summary of 'baz' here. (One line only)
```

You are also encouraged to comment your code with standard-style comments (`//` or `/* */`) as you see fit, although those comments won’t be included in the API Reference Guide.

For very dense comments (such as those deeply explaining how a function works internally) save those for the .cpp file, not the API header.

### Classes and Structures

Do not use a same-line comment ( `//!<` ) to document the class's description **itself**.

**Classes and Structures examples**:

```c++
//! One-line description of MyClass.
//! (optional) additional information can follow after the first period.
//! You may not use same-line comments ( //!< ) to describe the class here.
class MyClass
{
// Members, functions, etc. follow the other rules in this document and can use same-line comments as appropriate.
};
```

### Member Data

**Member Data Examples**:

```c++
//! Single-line description.
int m_var2;
int m_var2; //!< Brief description on same line. One line only!

//! Summary of m_var2 which ends with a period.
//! Any additional information about m_var2 that isn't part
//! of the brief summary.
int m_var2;
```

### Functions and Function Parameters

- **Parameters**
  - After the brief/detailed descriptions, document the parameters by using `@param`, the exact function parameter name, and then the description.
  - The first word after @param will be the name of the parameter you'd like to show in the documentation.
  - Document parameters only as needed. You almost always need to document a parameter since they tend to have nuances. The only time you might leave out a param documentation is if there is absolutely no information you can possibly provide to the reader that would enhance their understanding of what the parameter is for, and thus you would only be adding redundant noise to the header file.
- **Return Values**
  - If there is any side-effect or special handling detectable by return value, please be sure you include these details using the @return macro. It also follows the 'brief is everything up to the first period' rule and can be multiple lines.
- **Gotchas**
  - For the docs of the function parameters (`@param`), be sure to specify the exact parameter name (case sensitive) so that it matches exactly.
  - If a parameter is unnamed but still requires documentation, use the syntax `@param (Unnamed) brief description.` Doxygen will use the first word after param as the name, and it will thus show up in the document as `(Unnamed)`. If a parameter is relevant enough to require documentation beyond that its just unused, though, perhaps it should have a name!

**Functions and Function Parameters examples**:

```c++
//! Brief description of myFunction ending with a period.
//! Additional details about myFunction are after the first period
//! and can cover as many lines as you wish.
//! @param a Brief description of parameter named a.
//! Note that anything here is the extended description of the param because it is after the first period.
//! This happens regardless of whether its on the same line or not - doxygen will use the period. Format it nicely
//! for readers of the header file, too!
//! @param b Brief description of parameter named b. Note that b is a terrible name for a parameter (See the Coding Standards)
//! @return Brief description of the result.
int myFunction(int a, int *b, int);

//! Exits the program immediately with the given exit code
void exit(int exitCode = 0);
```

Note that the single line version should only be used if none of the parameters are remarkable or have any information to add, as well as there are no gotchas to return values or any other information a reader needs to know about.

**Example of redundant information (_don't do this_)**:

Do not add useless redundant information that makes the API header slower to read and understand just for the sake of claiming completeness.

```c++
//! Exits the program immediately.
//! This will immediately exit the program.
//! @param exitCode exit code
void exit(int exitCode = 0);
```

Usually there's something interesting about just about every param.

For example, it would have been useful to know that 0 means that there was no error, and nonzero exit codes signal a problem, as it might not be apparent to someone unfamiliar with the code. Redundant information is worse than no information at all as **it still costs time to read.**

### Macros

- **Gotchas**
  - If your macro is likely to perform multiple expansions or evaluations of expressions, you must note this to the user, as it can generate unexpected code.

**Macro examples**:

```c++
//! Brief description of MY_MACRO.
//! (optional) Details of MY_MACRO. (as many lines as you need)
#define MY_MACRO(a,b) (a+b)
```

### Enumerations

**Enumeration examples**:

```c++
//! Brief description of MyEnum.
//! Details of MyEnum. (Optional)
enum MyEnum
{
//! Brief Description of Value1.
//! (Optional) Additional details follow the period.
Value1,
//! Brief description of Value2, one line only.
Value2,
Value3, //!< Brief Description. Additional Details. Keep it short!
};
```

### Namespaces

You may optionally put a comment that indicates the end of the namespace if a reader is likely to be confused due to overlaps and distance. Do not use Doxygen style commenting for that end of namespace comment - (so just normal `//`, not `//!`)

- **Gotchas**
  - Do not document the namespace in multiple files. If Doxygen finds more than one doc for the same namespace, it will merge the docs, and you'll end up with duplicate information in the documentation.
  - If the namespace is declared in multiple header files, add the namespace's doc to **one** of those declarations only. If its a very complicated explanation, the other headers can refer to the main one in a normal comment.

**Namespace examples**:

```c++
//! Brief description of MyNamespace.
//! (optional) Details of MyNamespace following the first period.
namespace MyNamespace
{
    ...
} // namespace MyNameSpace (especially if its many many lines later and there's a confusing series of closing braces)
```

### Header files

Follow the General Style, but use a @file token to indicate its a comment about this file, not the following block of code.

- **Placement**
  - Put the comment at the top of the header file, directly under the copyright notice (but not within the same comment as the copyright notice), and before and #pragma's or #include's.
- **Gotchas**
  - Do not put the filename after @file. Leaving the filename blank indicates to Doxygen that the comment applies to the current file. This way, we will not need to change the comment if the filename changes.
  - Forgetting to use @file will apply the documentation to the next piece of code that appears after the comment.

**Header file examples**:

```c++
// [Boilerplate copyright notice]

//! @file
//! Brief description of file.
//! Details of file. (Optional)

#pragma once

...

#include <file.h>
#include <file2.h>

...
```

### Deprecations

Follow the General Style. In addition, if an API is deprecated, do two things:

- Put `Deprecated.` as the first line of the comment. On the second line, put **@deprecated** followed (if possible) by a brief explanation of why not to use it or what to use instead. The explanation is recommended but not required. The reason we put `Deprecated.` on the first line is because if we use `@deprecated` as the first line, Doxygen unfortunately leaves that API's entry in the summary table (at the top of the page) blank and we want customers to be able to scan down the summary and see an entry for all APIs.
- Unless you have a specific reason to surface the deprecation warning to the public docs (for example, you know customers have been using the deprecated API), hide the API from the public-facing docs using `@cond EXCLUDE_DOCS` as described in [Excluding code from the documentation](#excluding-code-from-the-documentation). Even though the @deprecated note will no longer have any effect on the public-facing docs, it will give customers looking into the header file the information.
  - Note that this uses special syntax as it needs to end the condition block afterwards.

The following example marks two functions as deprecated. The first function will be completely hidden from the public docs. The second function will show up in the public docs with the deprecation note.

```c++
//! Deprecated.
//! @deprecated Use SomeOtherFunction instead. (Not necessary to say 'deprecated' twice on this line)
//! rest of function documentation can be here as usual.
int ShownAndDeprecatedFunction(int a, int *b);

//! @cond EXCLUDE_DOCS
//! Deprecated.
//! @deprecated Use SomeOtherFunction instead.
//! rest of function documentation can be here as usual.
int HiddenAndDeprecatedFunction(int a, int *b);
//! @endcond

//! Deprecated. @deprecated Use SomeOtherFunction instead
int SomeDeprecated();
```

Note in that last case, it is using a single line comment style. This is only okay if there is sufficient understanding of the params and return type such that no documentation is required (or that adding more documentation would provide no new information).

### Complete Example

The following example includes all elements described above.

```c++
// [Boilerplate copyright notice]

//! @file
//! Brief description of file.
//! Details of file. (Optional)

#pragma once

#include <ModuleName/OtherFile.h>

//! Brief description of MyNamespace.
//! Details of MyNamespace. (Optional)
namespace MyNamespace
{
    //! Brief description of MyClass. If we needed more, we'd use a block comment style instead.
    class MyClass
    {
    public:
        int publicVar1; //!< Brief description. Additional details.

        //! Brief description of MyEnum.
        //! Details of MyEnum. (Optional)
        enum MyEnum
        {
            Value1, //!< Brief description. Additional details.
            //! Value2 is special.
            //! The reason for this is blah... (multiline)
            Value2
        };

        //! Brief description of myClass constructor.
        //! Details of myClass constructor. (Optional)
        MyClass();

        //! Brief description of myClass destructor.
        //! Details of myClass destructor. (Optional)
        ~MyClass();

        //! Brief description of myFunction.
        //! Details of myFunction. (Optional)
        //! @param a Description of parameter named a.
        //! @param b Description of parameter named b.
        //! @return Description of the result.
        int myFunction(int a, int b);

        //! @cond EXCLUDE_DOCS
        int HiddenFunction(int a, int *b);
        //! @endcond

        //! @cond EXCLUDE_DOCS
        //! @deprecated Use OtherFunction instead.
        int HiddenAndDeprecatedFunction(int a, int *b);
        //! @endcond

        //! Deprecated.
        //! @deprecated Use SomeOtherFunction instead.
        int ShownAndDeprecatedFunction(int a, int *b);

    private:
        int privateVar; //!< This comment is optional. Private attributes will not end up in public docs.
    };

    //! Brief description of MY_MACRO.
    //! Details of MY_MACRO. (Optional)
    #define MY_MACRO(a,b) (a+b)
} // namespace MyNamespace
```

## Extras

This section shows how to cross-link to other documentation, add a "See Also" section, add notes, and add code snippets. All of these are optional.

### Linking to other APIs

If you mention an API from another API's documentation, Doxygen will automatically link to the documentation of the mentioned API as long as you use the API's exact name. In the documentation generated by the following example, `OtherClass` will be replaced by a link to the documentation of `OtherClass`:

```c++
//! Brief description of MyClass.
//! Use this class instead of OtherClass when...
class MyClass
{
};
```

### Linking to Other Guides and Sites

You can link to other O3DE public documentation or reputable external sites by using the following format: `[link text](link URL)`.

The following example produces "As described in the [O3DE Developer Guide](https://o3de.org/docs/), you can use ColliderComponent to... "

```c++
//! Brief description of ColliderComponent.
//! As described in the [O3DE Developer Guide](https://o3de.org/docs/)
//! you can use ColliderComponent to...
class ColliderComponent
{
};
```

### See Also

Typically, you will do all of your documentation cross-references within your detailed descriptions by using the linking methods described in the previous sections. However, if you want to link to several topics and a list of links makes more sense, you can add an explicit "See Also" section. To add a "See Also" section within a comment block, use `@see` followed by your links separated by commas. The links should be in the form `<a href="URL">link text</a>`.

The following example produces the following section at the end of the `ColliderComponent` documentation:

**See also**: [Collider Component Concepts](https://o3de.org/docs/user-guide/components/reference/physx/collider/)

```c++
//! Brief description of ColliderComponent.
//! Details of ColliderComponent.
//! @see <a href="[]()">Collider C++ Class Hierarchy</a> in the O3DE Developer Guide
class ColliderComponent
{
};
```

### Notes

To add a note, preface the note by `@note`. However, use this notation sparingly. Most of the time, a "note" is just text that does not need to be specially labeled.

The following is an example of how to add a note.

```c++
//! Brief description of MyClass.
//! Details of MyClass. (Optional)
//! @note This is a note.
class MyClass
{
};
```

### Code Snippets

To include a code snippet, surround the snippet with `@code` and `@endcode`, and include it within the relevant element's documentation.

Don't use Doxygen's `example@` notation. That will cause Doxygen to put all of the examples on an Examples page, which we don't use.

If you have a long code example, the Developer Guide or another location might be a better way to deliver it to customers. If you have any doubt, feel free to ask [sig-documentation on Discord](https://discord.gg/fZ7CDwDxrh).

The following is an example of how to include a code snippet within the documentation of a class.

```c++
//!Brief description of SerializeContext.
//! Details of SerializeContext. To enable networking on a component, you must modify SerializeContext to include AzFramework::NetBindable as follows:
//! @code
//! if (serialize)
//! {
//! serializeContext->Class<ShipComponent, AzFramework::NetBindable, AZ::Component>()
//! ...
//! }
//! @endcode
class SerializeContext
{
};
```

### Section Comments

It is often helpful to use comments to divide and group sections of code in a header file. Common examples include grouping function overrides according to their common base class, and grouping related functions with a common theme. While this kind of annotation is not handled by Doxygen, it can still be useful for reading the source code. Section comments are required when a class overrides functions from multiple base classes. In other cases, section comments are optional.

- **Placement** Put the section comment above the section of code, optionally followed by a blank line.
- **Style** Several types of section comments are allowed. It's up to the programmer which to use.
  - **Divider** Use a long string of slashes: `/////////////////////////////////////`
  - **Major** section comment: Use a **divider** followed by a section description on the next line .
  - **Minor** section comment: Use a standard two-slash comment, followed by a short description, then ellipsis: `// description ...`
- **Naming.** When marking a section of function overrides, the description should be `BaseClassName overrides ...`. Otherwise the content of the description is up to the programmer.
- **Gotchas**
  - If it is unclear where the code section ends, use a divider to mark the end of the section.
  - Use dividers and section comments sparingly. Don't add unnecessary noise to the code.
  - Use two slashes, not three. (If you use three slashes it will get picked up by doxygen as a function header comment).

```c++
class MyClass
    : public TransformNotificationBus::Handler
    , public Component
{
    ...
    // Component overrides ... // <-- minor section comment; "..." distinguishes this from a function header comment
    void Activate() override;
    void Deactivate() override;
    bool ReadInConfig(const ComponentConfig* baseConfig) override;
    bool WriteOutConfig(ComponentConfig* outBaseConfig) const override;

    //////////////////////////////////////////////////////////////////////// <-- major section comment starts with a divider
    // TransformNotificationBus::Handler overrides <-- followed by section description, no "..." necessary
    void OnTransformChanged(const Transform&, const Transform&) override;
    void OnChildAdded(EntityId child) override;
    void OnChildRemoved(EntityId child) override;
    //////////////////////////////////////////////////////////////////////// <-- closing divider for clarity
    ...
};
```

## Excluding code from the documentation

There are different ways to signify to Doxygen to exclude something from the documentation. The method you use depends on the scope of what you want to exclude:

- To exclude an **entire header file**, add the header file name to the [EXCLUDE](http://www.doxygen.nl/config.html#cfg_exclude) section of the Doxygen config file. Be sure to include the path, because there might be multiple files with the same name. Look at the INPUT section of the Doxygen config file to see how we're specifying paths relative to the O3DE root. Also, make sure not to wipe out any existing items we have in the EXCLUDE section.
- To exclude an **entire namespace**, add the fully-qualified namespace to the [EXCLUDE_SYMBOLS](http://www.doxygen.nl/config.html#cfg_exclude_symbols) section of the Doxygen config file. Be sure not to wipe out any existing items we have in the EXCLUDE_SYMBOLS section.
- To exclude anything smaller in scope (e.g., a class), do it within the code by surrounding the item you want to exclude with conditional tags as follows:

```c++
//! @cond EXCLUDE_DOCS
class MyClass
{
};
//! @endcond
```

## Exceptions

Besides the chameleon rule, there may also be a need to use different comments inside multi-line macros.  However, its best to prefix the macro with a regular comment instead of put lots of code inside a comment, if possible.  In general, the inner workings of multi-line macros are not API documentation but just regular documentation of the code itself, and regular documentation rules should be used (// and /\*)

## Can I build the documentation to see the final result?

Sure. See [these instructions](https://o3de.org/docs/contributing/to-docs/) for how to get the config files, headers/footers/css files, and build the documentation. If you have questions, please ask [sig-documentation on Discord](https://discord.gg/fZ7CDwDxrh). However, you don't need to generate the docs by yourself unless you want to. Your docs will go through one or more editing passes, which should catch any grammar and/or formatting errors. Further, before the docs are pushed live, you will have the opportunity to see the staged content on the alpha or integration server.
